---
title: "GovTech24 - Informationsplattform Versorgungssicherheit"
output: 
  flexdashboard::flex_dashboard:
    theme: 
      version: 4
      bootswatch: minty
    orientation: rows
    vertical_layout: fill
runtime: shiny
---

<style>

body {
  padding-top:0px;
  background : #FFFFFF
}

.navbar{
  visibility: hidden
}

</style>

```{r setup, include=FALSE}
library(flexdashboard)
library(httr)
library(readr)
library(ggplot2)
library("tidyverse")
library("XML")
library("bslib")
```


```{r echo=FALSE, warnings=FALSE}
# Data Query Milch-Daten
rm(list=ls())

# packages ------------------------------------------------------------

# proxy_url <- "http://proxy-bvcol.admin.ch:8080"
# httr::set_config(httr::use_proxy(proxy_url))


# SPARQL query to LINDAS --------------------------------------------------

sparql_string <- paste0('
  PREFIX cube: <https://cube.link/>
  PREFIX sh: <http://www.w3.org/ns/shacl#>
  PREFIX schema: <http://schema.org/>
  PREFIX time: <http://www.w3.org/2006/time#>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

  SELECT DISTINCT
                 ?measure
    ?year ?month
  WHERE {
    GRAPH <https://lindas.admin.ch/foag/agricultural-market-data> {
      VALUES(?product) {
(<https://agriculture.ld.admin.ch/foag/product/4>) }

      <https://agriculture.ld.admin.ch/foag/cube/MilkDairyProducts/Production_Quantity_Month> cube:observationSet ?observationSet .
      ?observationSet cube:observation ?observation .
    ?observation <https://agriculture.ld.admin.ch/foag/dimension/date> ?date .
    ?observation <https://agriculture.ld.admin.ch/foag/dimension/product> ?product .
    ?observation <https://agriculture.ld.admin.ch/foag/measure/quantity> ?measure .

      }
  ?date time:year ?year.
    OPTIONAL { ?date time:month ?month. }
  }
                        ')

# print(sparql_string)

query <- POST("https://ld.admin.ch/query",
              add_headers("Accept" = "text/csv"),
              content_type("application/x-www-form-urlencoded; charset=UTF-8"),
              body = paste("query=", sparql_string, sep = ""))

data <- content(query, encoding = "UTF-8")

```

```{r}

# Funktion für Farbgebung der Valueboxes 
color_fun <-     function(value){ if (value < 0) {
      "red"
    } else if (value >= 30 & value < 70) {
      return("orange")
    } else {
      return("#216869")
    }}
    
```


```{r}

# Funktion für Pfeil
arrow_fun <-     function(value){ if (value < 0) {
      "arrow-down"
    } else if (value >= 30 & value < 70) {
      return("arrows-h")
    } else {
      return("arrow-up")
    }}
    
```

Gauges {data-width=200}
-------------------------------------

### Milchproduktion

```{r}
renderValueBox({
    value <- runif(1, min = -100, max = 100) # Generate a random value between 0 and 100
    # Determine the color based on the value
    # Create the value box with the determined color
    valueBox(
      formatC(value, format = "f", digits = 2), # Display the value formatted to 2 decimal places
      # subtitle = "Random Value",
      color = color_fun(value),
      showcase = bs_icon("music-note-beamed"),
    )
  })

# shiny::icon("arrow-down")
```

### Milchimport 

```{r}
renderValueBox({
    value <- runif(1, min = -100, max = 100) # Generate a random value between 0 and 100
    # Determine the color based on the value
    # Create the value box with the determined color
    valueBox(
      formatC(value, format = "f", digits = 2), # Display the value formatted to 2 decimal places
      # subtitle = "Random Value",
      color = color_fun(value)
    )
  })
```

### Selbstversorgungsgrad XY

```{r}

```

Column {data-width=650}
-----------------------------------------------------------------------

### Entwicklung Produktion

```{r}

```

Column {data-width=350}
-----------------------------------------------------------------------

### Entwicklung Import

```{r}

```

